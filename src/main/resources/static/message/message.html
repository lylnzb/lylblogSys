<!DOCTYPE html>
<!-- saved from url=(0072)https://www.17sucai.com/preview/2137395/2020-07-07/templates/index.html# -->
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>留言反馈 -羅氏博客</title>
    <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
    <link rel="stylesheet" href="../common/semantic-ui/dist/semantic.min.css">
    <link rel="stylesheet" href="../common/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../common/css/style.css">
    <link rel="stylesheet" href="../common/css/tx.css">
    <link rel="stylesheet" href="../common/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="../common/qqFace/css/reset.css">
    <link rel="stylesheet" href="../common/css/index.css">
    <link rel="stylesheet" href="../common/css/mplayer.css">
    <link rel="stylesheet" href="../login/css/login.css">
    <link rel="stylesheet" href="/common/css/icons.css">
    <link rel="stylesheet" href="/common/css/zoom.css">
    <style>
        .comment-text-center {
            cursor: pointer;
            text-align: center;
            margin: 18px 0;
            font-size: 16px;
            font-size: 1.15em;
            color: #338A9C;
            font-weight: 500;
        }
    </style>
</head>
<body id="mainBody">
<!-- 遮盖层 -->
<div id="bg" class="bg"></div>

<!-- 登录框 -->
<div class="login">
    <div th:replace="login/login :: loginBox"></div>
</div>

<!--导航-->
<div id="header">
    <div th:replace="include/header :: myHeader"></div>
</div>

<!--音乐-->
<div id="music">
    <div th:replace="include/music :: myMusic"></div>
</div>

<!--中间-->
<div id="main">
    <div class="m-padded-tb-max">
        <div class="ui container">
            <div class="leave_position" style="font-size: 14px;font-weight: bold;margin-bottom: -10px;">
                <i class="fa fa-map-marker"></i>
                &nbsp;您现在的位置是：<a style="font-size: 14px;font-weight: bold;">首页</a>&nbsp;>&nbsp;<a style="font-size: 14px;font-weight: bold;">留言反馈</a>
            </div>
            <div class="ui stackable grid">
                <!--左边-->
                <div class="eleven wide column">
                    <div class="ui attached segment form">
                        <div class="field">
                            <div class="ui secondary pointing menu">
                                <a class="item active" data-tab="tab-name">留言板</a>
                            </div>
                            <div class="ui tab active" data-tab="tab-name">
                                <div id="editor" class="editor" placeholder="对我说点什么吧...." contenteditable="true"></div>
                                <input id="saytext" name="saytext" type="text" style="display: none"/>
                                <div class="app">
                                    <div id="emoji" style="display:inline-block;">
                                        <i id="emotion" style="font-size: 30px;cursor:pointer;" class="smile icon"></i>
                                    </div>&nbsp;
                                    <div id="image" style="display:inline-block;margin-left:10px;">
                                        <div id="imageBox1" style="display: none">
                                            <img id="showimg1" src="" alt=""/>
                                            <i id="close1" class="close icon" onclick="$('#imageBox1').hide();"></i>
                                            <i class="caret up"></i>
                                        </div>
                                        <div id="uploadImg">
                                            <input type="file" accept="image/*" onchange="showImg(1,this)"/>
                                        </div>
                                        <i style="font-size: 30px;cursor:pointer;" class="image icon"></i>
                                    </div>
                                    <div class="submit" >
                                        <button class="ui primary button" id="sub_btn" onclick="releaseMessage(1, '')">发布评论</button>
                                    </div>
                                </div>
                                <div class="ui divider" style="margin-top: 25px"></div>
                                <div class="message">
                                    <span style="font-size: 20px">留言列表(<span id="totalCommentCount" style="color:#E1171B" th:text="${totalCommentCount}">0</span>)</span>
                                </div>
                                <div class="ui divider"></div>
                                <div id="noComment" style="display: none">
                                    <h2 class="comment-text-center">
                                        <i class="frown outline icon"></i>还没有评论，来说两句吧...
                                    </h2>
                                </div>
                                <div class="ui comments" id="commentList"></div>
                                <div id="page" style="text-align: right;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--右边-->
                <div class="five wide column">
                    <!--标签-->
                    <div class="ui segments">
                        <div class="ui secondary segment">
                            <div class="ui two column grid">
                                <div class="column">
                                    <i class="tags icon"></i>最新书籍
                                </div>
                                <div class="right aligned column">
                                    <a href="https://www.17sucai.com/preview/2137395/2020-07-07/templates/index.html#">更多 &gt;&gt;</a>
                                </div>
                            </div>
                        </div>
                        <div class="ui teal segment">
                            <div class="ui items">
                                <div class="item">
                                    <a class="ui small image" style="width: 90px;height: 130px">
                                        <img src="../img/thumb.png">
                                    </a>
                                    <div class="content">
                                        <a class="header">JSP动态网站技术入...</a>
                                        <div class="description">
                                            <p>Java在Internet领域内发展出来的JSP(Java Server Page)和Servlet技术是...</p>
                                        </div>
                                        <div class="extra">
                                            <div class="ui label">作者：太阳工作室</div>
                                            <div class="ui label"><i class="eye icon"></i>10</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="ui divider"></div>
                                <div class="item">
                                    <a class="ui small image" style="width: 90px;height: 130px">
                                        <img src="../img/biancheng.jpg">
                                    </a>
                                    <div class="content">
                                        <a class="header">Java编程思想(第4版)</a>
                                        <div class="description">
                                            <p>编辑推荐《Java编程思想(第4版)》获奖历史：·2003年《Software Development》...</p>
                                        </div>
                                        <div class="extra">
                                            <div class="ui label">作者：埃史尔</div>
                                            <div class="ui label"><i class="eye icon"></i>10</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="ui divider"></div>
                                <div class="item">
                                    <a class="ui small image" style="width: 90px;height: 130px">
                                        <img src="../img/javahx.jpg">
                                    </a>
                                    <div class="content">
                                        <a class="header">Java核心技术(卷1):基...</a>
                                        <div class="description">
                                            <p>Java领域最有影响力和价值的著作之一，与《Java编程思想》齐名，10余年全球...</p>
                                        </div>
                                        <div class="extra">
                                            <div class="ui label">作者：霍斯特曼</div>
                                            <div class="ui label"><i class="eye icon"></i>10</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="ui divider"></div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--底部-->
<div id="footer">
    <div th:replace="include/footer :: myFooter"></div>
</div>
</body>
</html>
<!--<script src="../common/jquery/jquery-1.11.1.js"></script>-->
<script src="../common/qqFace/js/jquery.min.js"></script>
<script src="/common/coco-message.js"></script>
<script src="../common/util.js"></script>
<script src="../common/qqFace/js/jquery.qqFace.js"></script>
<script src="../common/semantic-ui/dist/semantic.min.js"></script>
<script src="../login/js/login.js"></script>
<script src="../common/layui/layui.all.js"></script>
<script src="/common/mPlayer/mplayer.js"></script>
<script src="/common/mPlayer/mplayer-list.js"></script>
<script src="/common/mPlayer/mplayer-functions.js"></script>
<script src="http://cdn.bootcss.com/jquery-nstslider/1.0.13/jquery.nstSlider.min.js"></script>
<script type="text/javascript" src="/common/player.js"></script>
<script type="text/javascript" src="/common/mo.min.js"></script>
<script type="text/javascript" src="/common/demo.js"></script>
<script type="text/javascript" src="/common/zoom.js"></script>
<script>
    $(document).ready(function(){
        messageList();

        $('.pointing.menu .item').tab();

        $('#emotion').qqFace({
            id : 'facebox',
            assign:'editor',
            path:'/common/qqFace/arclist/'	//表情存放的路径
        });

        $(".like").click(function(){
            var html = "+1";
            $(this).find('em').html(html);
            $(this).find('em').fadeIn(500);
            $(this).find('em').fadeOut(500);
            setTimeout(function () {
                $(this).attr('data-num', '9');
                $(this).find('.num').html('4');
            }, 500);
        });

        $(document).on('click','.reply',function(){
            $(".replyBar").remove();
            var html = '';
            html += '<div class="replyBar" style="margin-top: 5px;">';
            html += '    <div id="reply" class="editor" placeholder="回复 ' + $(this).attr("data-name") + '" contenteditable="true"></div>';
            html += '    <div class="app">';
            html += '        <div class="emoji" style="display:inline-block;">';
            html += '            <i style="font-size: 30px;cursor:pointer;" class="smile icon emotion"></i>';
            html += '        </div>';
            html += '        <div class="image" style="display:inline-block;">';
            html += '            <div id="imageBox2" style="display: none">';
            html += '                <img id="showimg2" src="" alt=""/>';
            html += '                <i id="close2" class="close icon" onclick="$(\'#imageBox2\').hide()"></i>';
            html += '                <i class="caret up"></i>';
            html += '            </div>';
            html += '            <div id="uploadImg">';
            html += '                <input type="file" accept="image/*" style="cursor:pointer;" onchange="showImg(2,this)"/>';
            html += '            </div>';
            html += '            <i style="font-size: 30px;" class="image icon"></i>';
            html += '        </div>';
            html += '        <div class="submit">';
            html += '            <button class="ui primary button" clsss="sub_btn" onclick="releaseMessage(2, \'' + $(this).attr("data-id") + '\')">发布评论</button>';
            html += '        </div>';
            html += '    </div>';
            html += ' </div>';
            $(this).parent().append(html);

            $('.emotion').qqFace({
                id : 'facebox1',
                assign:'reply',
                path:'/common/qqFace/arclist/'	//表情存放的路径
            });
        });
    });

    function showImg(id,file){
        var reader = new FileReader();	// 实例化一个FileReader对象，用于读取文件
        var img = '';
        if(id == 1){
            img = document.getElementById('showimg1'); 	// 获取要显示图片的标签
        }else if(id == 2){
            img = document.getElementById('showimg2'); 	// 获取要显示图片的标签
        }
        //读取File对象的数据
        reader.onload = function(evt){
            img.width  =  "80";
            img.height =  "80";
            img.src = evt.target.result;
        }
        reader.readAsDataURL(file.files[0]);
        if(id == 1){
            $("#imageBox1").show();
        }else if(id == 2){
            $("#imageBox2").show();
        }
    }

    /**
     * 评论发布
     */
    function releaseMessage(type, commentId){
        var paramData = new Object();
        if(type == 1){
            paramData.commentContent = $("#editor").html();
        }else if(type == 2){
            paramData.replyId = commentId;
            paramData.commentContent = $("#reply").html();
        }
        $.ajax({
            url: basePath + "message/releaseMessage",
            type:"POST",
            data:JSON.stringify(paramData),
            dataType:"json",
            contentType : 'application/json;charset=utf-8',
            //设置ajax请求结束后的执行动作
            complete : function(XMLHttpRequest) {
                // 通过XMLHttpRequest取得响应头
                var redirect = XMLHttpRequest.getResponseHeader("isLogin");//未登录
                if (redirect == 'false') {
                    localRefresh('/common/headerRefresh', '#header');
                    messageList();
                }
            },
            success:function(resultData){
                if(resultData.code==0){
                    cocoMessage.success(resultData.msg, 3000); //duration为0时显示关闭按钮
                    messageList();
                    $("#totalCommentCount").text(parseInt($("#totalCommentCount").text())+ 1);//总评论数+1
                    $("#editor").html("");//文本清空
                }else{
                    cocoMessage.error(resultData.msg, 3000); //loading可以选择是否展示关闭按钮
                }
            }
        });
    }

    //悬浮变色事件
    $('.like').mouseover(function(){
        $(this).css({
            'color':'#212E0A4E'
        });
    });

    $('.like').mouseout(function(){
        $(this).css({
            'color':'#333'
        });
    });

    /**
     * 评论列表展示
     * @param wznm
     */
    function messageList(page, limit){
        var paramData = new Object();
        paramData.page = page;
        paramData.limit = limit;
        $.ajax({
            url: basePath + "message/messageList",
            type:"POST",
            data:JSON.stringify(paramData),
            asyns:false,
            dataType:"json",
            contentType : 'application/json;charset=utf-8',
            success:function(resultData){
                var htmlStr = '';
                if(resultData.code == 0){
                    var data = resultData.data;
                    layui.use(['laypage', 'layer'], function () {
                        $("#noComment").hide();

                        var page = layui.laypage;
                        page.render({
                            elem: 'page',
                            count: resultData.count,
                            curr: paramData.page,
                            limit: paramData.limit,
                            jump: function (obj, first) {
                                if (!first) {
                                    messageList(obj.curr, obj.limit)
                                }
                            }
                        });
                        for(var i = 0;i < data.length;i++){
                            var style = "";
                            if(data[i].giveLike){
                                style = "color: red";
                            }
                            htmlStr += '<div class="comment">';
                            htmlStr += '    <a class="avatar">';
                            htmlStr += '        <img src="/profile/' + data[i].iconUrl + '">';
                            htmlStr += '    </a>';
                            htmlStr += '    <div class="content" style="width: 100%;">';
                            htmlStr += '        <a class="author" style="font-size: 14px;font-weight: bold">' + data[i].commitName + '</a>';
                            htmlStr += '        <div class="metadata" style="float: right;font-size: 14px;color: #8590a6;">';
                            htmlStr += '            <span class="date">' + data[i].time + '</span>';
                            htmlStr += '        </div>';
                            htmlStr += '        <div class="text" style="margin-top: 7px">' + data[i].content + '</div>';
                            htmlStr += '        <div class="actions">';
                            htmlStr += '            <a class="reply" data-id="'+ data[i].id +'" data-name="' + data[i].commitName + '" style="display:inline-block;font-size: 15px;font-weight: bold;">回复</a>';
                            htmlStr += '            <div class="like" style="display:inline-block;margin-left: -10px;">';
                            htmlStr += '                <button class="icobutton icobutton--thumbs-up" style="' + style + '"><span data-id="'+ data[i].id +'" data-text="' + data[i].giveLike + '" class="fa fa fa-thumbs-o-up" id="effect-' + i + '" style="font-size: 14px;font-weight: bold;"></span></button><span class="num" style="color: #666;font-size: 14px;font-weight: bold;display: inline-block;margin-left: 2px;">' + data[i].praiseNum + '</span>';
                            htmlStr += '            </div>';
                            htmlStr += '        </div>';
                            htmlStr += '        <div class="ui divider" style="margin-top: 10px"></div>';
                            htmlStr += '    </div>';
                            htmlStr += '    <div class="comments" style="margin-top: -15px;margin-bottom: -28px;">';
                            for(var j = 0;j < data[i].childCommentList.length;j++){
                                var style = "";
                                if(data[i].childCommentList[j].giveLike){
                                    style = "color: red";
                                }
                                htmlStr += '       <div class="comment">';
                                htmlStr += '          <a class="avatar"><img src="/profile/' + data[i].childCommentList[j].iconUrl + '"></a>';
                                htmlStr += '          <div class="content" style="width: 100%;">';
                                htmlStr += '              <a style="font-size: 14px;font-weight: bold">' + data[i].childCommentList[j].commitName + '</a><span style="margin-left: 5px;margin-right: 5px;color: #8590a6;">回复</span><a style="font-size: 14px;font-weight: bold">' + data[i].childCommentList[j].replyName + '</a>';
                                htmlStr += '              <div class="metadata" style="float: right;font-size: 14px;color: #8590a6;">';
                                htmlStr += '                  <span class="date">' + data[i].childCommentList[j].time + '</span>';
                                htmlStr += '              </div>';
                                htmlStr += '              <div class="text" style="margin-top: 7px">' + data[i].childCommentList[j].content + '</div>';
                                htmlStr += '              <div class="actions">';
                                htmlStr += '                  <a class="reply" data-id="'+ data[i].childCommentList[j].id +'" data-name="' + data[i].childCommentList[j].commitName + '" style="display:inline-block;font-size: 15px;font-weight: bold;">回复</a>';
                                htmlStr += '                  <div class="like" style="display:inline-block;margin-left: -10px;">';
                                htmlStr += '                      <button class="icobutton icobutton--thumbs-up" style="' + style + '"><span data-id="'+ data[i].childCommentList[j].id +'" data-text="' + data[i].childCommentList[j].giveLike + '" class="fa fa fa-thumbs-o-up" id="effect-' + i + '-' + j + '" style="font-size: 14px;font-weight: bold"></span></button><span class="num" style="color: #666;font-size: 14px;font-weight: bold;display: inline-block;margin-left: 2px;">' + data[i].childCommentList[j].praiseNum + '</span>';
                                htmlStr += '                  </div>';
                                htmlStr += '              </div>';
                                htmlStr += '              <div class="ui divider" style="margin-top: 10px"></div>';
                                htmlStr += '           </div>';
                                htmlStr += '        </div>';
                            }
                            htmlStr += '    </div>';
                            htmlStr += '</div>';
                        }
                        $("#commentList").html(htmlStr);
                        //点赞特效
                        giveLike();
                    })
                }else {
                    $("#noComment").show();
                }
            }
        });
    }
</script>